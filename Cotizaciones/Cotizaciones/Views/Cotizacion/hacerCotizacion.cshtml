@model HacerCotizacionModel
@{
    ViewData["Title"] = "hacerCotizacion";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="card-group">
    <div class="card">
        <div class="card-header">
            Listado de Productos
        </div>
        <div class="card-body">
            <select id="familySelect" class="form-control" aria-label="Default select example">
                <option value = "-1" selected>Todos</option>
                @foreach(var item in Model.Familia){
                    <option value="@item.IdFamilia">@item.Nombre</option>
                }
                
               
            </select>
            <table class="table" id="tablaDatos">
                <thead>
                    <tr>
                        <th scope="col">Nombre Producto</th>
                        <th scope="col">Stock</th>
                        <th scope="col">Precio</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.productos)
                    {
                        <tr>
                            
                            <td>@item.Nombre</td>
                            <td>@item.Stock</td>
                            <td>@item.precio</td>
                        <td><a class="btn btn-primary btn-sm " asp-action="VerCotizacion" asp-controller="Cotizacion" asp-route-idProdcuto="@item.IdPrudcuto"> <i class="bi bi-plus"></i> Agregar</a></td>
                        </tr>
                    }

                    
                    
                </tbody>
            </table>

        </div>
    </div>

    <div class="card">
        <div class="card-header">
            Listado para la Cotizacion
        </div>
        <div class="card-body">
            <table class="display" id="cotizacion" style="width:100%">
                <thead>
                    <tr>
                        <th scope="col">Nombre Producto</th>
                        <th scope="col">Cantidad</th>
                        <th scope="col">Precio</th>
                        <th scope="col">Total</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                   



                </tbody>
            </table>
        </div>
        <div class="card-footer">
            <button class="btn btn-info" onclick="GuardarInfo()">Guardar Cotizacion</button>
            
    </div>
    </div>
</div>

@section Scripts {
    <script>

    
        $(document).ready(function () {

            $('#familySelect').change(function () {
                
                var id = $(this).val();

                console.log(id)
                

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("ProductosPorFamilia")',
                    dataType : 'json',
                    data: {idFamilia : id},
                    success: function (result) {
                        console.log(result);                              
                        actualizarTabla(result)
                    },
                    error: function () {
                        console.error('Error al hacer solicitud')
                    }
                });
            });

            function actualizarTabla(productos) {
                $('#tablaDatos tbody').empty();
                console.log(productos);
               
                productos.forEach(function (dato) {
                    $('#tablaDatos tbody').append(
                        '<tr>' +
                        '<td>' + dato.nombre + '</td>' +
                        '<td>' + dato.stock + '</td>' +
                        '<td>' + dato.precio + '</td>' +
                        '<td> <button  class="btn btn-primary btn-sm" type="button" data-id="' + dato.idPrudcuto + '"> <i class="bi bi-plus" > </i> Agregar</button> </td>' +
                        '</tr>'
                    );
                });
            }
            $('#tablaDatos tbody').on('click', 'button', function () {
                var idProducto = $(this).data('id');
                abrirCotizacion(idProducto);
                console.log(idProducto)
            });

            function abrirCotizacion($idProducto){
                console.log($idProducto)
          
                $.ajax({
                    type:'POST',
                    url: '@Url.Action("AbrirVista")',
                    data: { idProdcuto : $idProducto },
                    success: function (data) {
                        $('#miModal').html(data);
                        $('#miModal').modal('show');
                    }
                });
            }



                // $('.intro').on('input', function () {
           
                //     var valorInput = $('.intro').val();
                //     var precio = parseFloat($('.price').text()); 

                //     if (!isNaN(valorInput) && !isNaN(precio)) {
                        
                //         var resultado = valorInput * precio;
                //         $('.result').text(resultado);
                //     } else {
                       
                //         alert('Por favor, ingresa un número válido.');
                //     }
                // });
        });

           
    </script>
}

